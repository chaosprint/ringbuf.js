<!doctype html>
<html>
<head>
<meta charset=utf-8>
<meta name="viewport" content="width=600,initial-scale=1">
<link rel=stylesheet href=style.css>
</head>
<body>
<a class=back href=index.html>Back to main</a>
<h1>
  Sending the output of an <code>AudioWorkletProcessor</code> to a Worker
</h1>
<p>
  An <code>AudioWorkletProcessor</code> generates or receives audio data. It
  writes to a ring buffer. The consumer of the ring buffer is running in a Web
  Worker, and this Worker buffers the input audio data. 
</p>
<p>
  After playing a bit of audio and stopping, a wav file of the recording can be
  downloaded.
</p>
<p>
  While this is running, this page artificially loads the main thread to
  simulate an heavy Web app front-end.
</p>
<p>
  <button disabled id=startstop>Start</button>
  <button disabled id=download>Download</button>
</p>
<script src=utils.js></script>
<script>
  var ac = new AudioContext;
URLFromFiles(['processor.js', 'index.js']).then((e) => {
  if (ctx.audioWorklet === undefined) {
    log("No AudioWorklet");
  } else {
    ctx.audioWorklet.addModule(e).then(() => {
      var osc = new OscillatorNode(ac);
      var fm = new OscillatorNode(ac);
      var am = new GainNode(ac);
      am.gain.value = 110;
      fm.connect(am).connect(osc.frequency).connect(ac.destination);
      osc.connect(recorderWorklet);
      startstop.disabled = false;
      startstop.onclick = function() {
        if (startstop.innerText == "Start") {
          osc.start(0);
          fm.start(0);
          startstop.innerText = "Stop";
        } else {
          osc.stop(0);
        }
      }
    }
  }
}
</script>
</body>
</html>
